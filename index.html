<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoreo Operativo Per√∫ - Lima Airport</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --azul-oscuro: #004a7c;
            --azul-notam: #005691;
            --celeste-fondo: #fcfdfe;
            --blanco: #ffffff;
            --punto-alerta: #e74c3c;
            /* Rojo vibrante */
            --rojo-alerta: #e74c3c;
            --gris-texto: #334155;
            --borde-card: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--celeste-fondo);
            color: var(--gris-texto);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-y: auto;
            /* Scroll vertical habilitado */
        }

        header {
            background: linear-gradient(to bottom, var(--azul-notam), var(--azul-oscuro));
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #003355;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 1100;
        }

        header h1 {
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        .status-bar {
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 12px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        main {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            min-height: calc(100vh - 60px);
            /* Altura m√≠nima pero puede crecer */
            flex-wrap: wrap;
            /* Permite que bajen si no caben de ancho en pantallas muy peque√±as */
        }

        /* Contenedores de Card */
        .card-container {
            background: var(--blanco);
            border: 1px solid var(--borde-card);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
            position: relative;
            flex: 1;
            min-width: 450px;
            /* Evita que se vuelvan muy flacos */
            min-height: 550px;
            /* Asegura espacio para el mapa y la tabla */
        }

        /* T√≠tulo del Mapa (Estilo imagen) */
        .card-title-fixed {
            padding: 12px 15px;
            border-bottom: 1px solid var(--borde-card);
            font-weight: 700;
            color: var(--azul-oscuro);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
        }

        .card-title-fixed::before {
            content: '';
            width: 4px;
            height: 18px;
            background: var(--punto-alerta);
            display: inline-block;
            border-radius: 2px;
        }

        #map {
            width: 100%;
            flex: 1;
            z-index: 10;
        }

        /* Limpiar grillas del mapa (OpenStreetMap a veces las muestra) */
        .leaflet-tile-container {
            filter: brightness(1.05) contrast(0.95);
        }

        .leaflet-container {
            background-color: #f8fafc !important;
        }

        /* Leyenda Mapa */
        .map-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 15px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid var(--borde-card);
        }

        /* Estilo para capas meteorol√≥gicas inactivas */
        .layer-disabled {
            opacity: 0.4 !important;
            filter: grayscale(1);
            pointer-events: none;
            cursor: not-allowed;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            background: var(--punto-alerta);
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 0 1px var(--punto-alerta);
        }

        /* Tabla Estilo Panel */
        .table-header-pro {
            background: #f8fafc;
            padding: 12px 15px;
            border-bottom: 1px solid var(--borde-card);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header-pro h2 {
            font-size: 0.9rem;
            color: var(--azul-oscuro);
            font-weight: 700;
        }

        /* Men√∫ de Filtros (Hamburguesa) */
        .filter-container {
            position: relative;
        }

        .btn-filter {
            background: none;
            border: none;
            font-size: 1.4rem;
            color: var(--azul-oscuro);
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .btn-filter:hover {
            transform: scale(1.1);
        }

        .dropdown-filter {
            position: absolute;
            top: 40px;
            right: 0;
            background: white;
            border: 1px solid var(--borde-card);
            border-radius: 6px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            width: 180px;
            display: none;
            /* Oculto por defecto */
        }

        .dropdown-filter.active {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        .filter-option {
            padding: 10px 15px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gris-texto);
        }

        .filter-option:hover {
            background-color: #f8fafc;
        }

        .filter-option.active {
            background-color: #f0f9ff;
            color: #0369a1;
            font-weight: 700;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f1f5f9;
            color: var(--azul-oscuro);
            font-size: 0.75rem;
            text-transform: uppercase;
            padding: 12px 15px;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 20;
            border-bottom: 1px solid var(--borde-card);
        }

        td {
            padding: 12px 15px;
            font-size: 0.85rem;
            border-bottom: 1px solid #f1f5f9;
        }

        tr:hover {
            background-color: #f8fafc;
        }

        /* Marcadores Mapa */
        @keyframes pulse-red {
            0% {
                transform: scale(0.6);
                opacity: 1;
            }

            100% {
                transform: scale(3);
                opacity: 0;
            }
        }

        .radar-pulse {
            width: 20px;
            height: 20px;
            background: rgba(231, 76, 60, 0.4);
            border-radius: 50%;
            position: absolute;
            animation: pulse-red 1.8s infinite ease-out;
            pointer-events: none;
        }

        .dot-marker-pro {
            background: var(--punto-alerta);
            border: 2.5px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .leaflet-tooltip-own {
            background: none !important;
            border: none !important;
            color: var(--punto-alerta) !important;
            font-weight: 900;
            font-size: 0.85rem;
            padding: 0;
            box-shadow: none !important;
            /* Truco Pro: Halo blanco para leer sobre el mapa */
            text-shadow:
                -1.5px -1.5px 0 #fff,
                1.5px -1.5px 0 #fff,
                -1.5px 1.5px 0 #fff,
                1.5px 1.5px 0 #fff;
            pointer-events: auto !important;
            /* Habilitar interacci√≥n */
            cursor: pointer;
            white-space: nowrap;
            z-index: 1000;
        }

        /* Eliminar la flecha del tooltip */
        .leaflet-tooltip-left::before,
        .leaflet-tooltip-right::before,
        .leaflet-tooltip-top::before,
        .leaflet-tooltip-bottom::before {
            display: none !important;
        }

        .leaflet-tooltip-left::before {
            border-left-color: rgba(255, 255, 255, 0.95);
        }

        .leaflet-tooltip-right::before {
            border-right-color: rgba(255, 255, 255, 0.95);
        }

        /* Badges de Sentido (Alto Contraste) */
        .badge-salida {
            background-color: #0369a1;
            color: #ffffff;
            font-weight: 700;
            font-size: 0.7rem;
            padding: 4px 12px;
            border-radius: 12px;
            display: inline-block;
            box-shadow: 0 1px 3px rgba(3, 105, 161, 0.3);
            letter-spacing: 0.5px;
        }

        .badge-llegada {
            background-color: #e0f2fe;
            /* Celeste suave */
            color: #0369a1;
            /* Azul corporativo */
            font-weight: 700;
            font-size: 0.7rem;
            padding: 4px 12px;
            border-radius: 12px;
            display: inline-block;
            box-shadow: 0 1px 3px rgba(3, 105, 161, 0.2);
            letter-spacing: 0.5px;
        }

        /* Estilos para el Bot√≥n Reset View */
        .leaflet-control-reset {
            background-color: #fff;
            width: 32px;
            height: 32px;
            line-height: 32px;
            text-align: center;
            text-decoration: none;
            color: #333;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-bottom: 2px solid #e2e8f0;
            transition: all 0.2s;
        }

        .leaflet-control-reset:hover {
            background-color: #f8fafc;
            color: var(--azul-oscuro);
        }

        .badge-cancel {
            background: #fee2e2;
            color: #ef4444;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.7rem;
            border: 1px solid #fecaca;
        }

        .vuelo-id {
            color: var(--azul-oscuro);
            font-weight: 700;
        }

        /* Badge del Contador */
        .counter-badge {
            background: var(--punto-alerta);
            color: white;
            padding: 3px 12px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 0.75rem;
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>

<body>

    <header>
        <h1>Vigilancia de Tr√°fico A√©reo - Lima Airport</h1>
        <div class="status-bar" id="sync-time">Cargando datos operativos...</div>
    </header>

    <main>
        <!-- Card Mapa -->
        <div class="card-container">
            <div class="card-title-fixed">MONITOREO OPERATIVO PER√ö</div>
            <div id="map"></div>
            <div class="map-legend">
                <div class="legend-dot"></div>
                <span>Vuelos Cancelados Hoy</span>
            </div>
        </div>

        <!-- Card Tabla -->
        <div class="card-container">
            <div class="table-header-pro">
                <div style="display:flex; align-items:center; gap:10px;">
                    <h2>PANEL DE CONTROL</h2>
                    <div id="flight-count-badge" class="counter-badge">0</div>
                </div>
                <!-- Bot√≥n Hamburguesa de Filtro -->
                <div class="filter-container">
                    <button class="btn-filter" id="btn-hamburguesa" title="Filtrar Vuelos">‚ò∞</button>
                    <div class="dropdown-filter" id="menu-filtros">
                        <div class="filter-option active" data-filter="TODOS">üåê TODOS LOS VUELOS</div>
                        <div class="filter-option" data-filter="SALIDAS">üõ´ SOLO SALIDAS</div>
                        <div class="filter-option" data-filter="LLEGADAS">üõ¨ SOLO LLEGADAS</div>
                    </div>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="flights-table">
                    <thead>
                        <tr>
                            <th>Sentido</th>
                            <th>Vuelo</th>
                            <th>Aerol√≠nea</th>
                            <th>Ciudad</th>
                            <th>H. Prog</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const COORDENADAS = {
            "LIMA": [-12.0219, -77.1143],
            "AREQUIPA": [-16.3411, -71.5668],
            "CUSCO": [-13.5357, -71.9153],
            "IQUITOS": [-3.7847, -73.3088],
            "PIURA": [-5.2056, -80.6164],
            "JULIACA": [-15.4671, -70.1582],
            "TARAPOTO": [-6.5085, -76.3732],
            "TRUJILLO": [-8.0805, -79.1089],
            "PUCALLPA": [-8.3779, -74.5742],
            "TACNA": [-18.0531, -70.2759],
            "SAN JUAN DE MARCONA": [-15.3615, -75.1633],
            "CHICLAYO": [-6.7875, -79.8281],
            "CAJAMARCA": [-7.1395, -78.4897],
            "AYACUCHO": [-13.1547, -74.2043],
            "PUERTO MALDONADO": [-12.6133, -69.2286],
            "TUMBES": [-3.5525, -80.3814],
            "TALARA": [-4.5128, -81.2541],
            "JAUJA": [-11.7831, -75.4742],
            "HUANUCO": [-9.8783, -76.2047],
            "ANTA - HUARAZ": [-9.3475, -77.5983],
            "JAEN": [-5.5925, -78.7725],
            "YURIMAGUAS": [-5.8953, -76.1206],
            "ILO": [-17.6975, -71.3469],
            "PISCO": [-13.7439, -76.2203],
            "TINGO MARIA": [-9.2847, -75.9961],
            "ANDAHUAYLAS": [-13.6558, -73.3517],
            "CHACHAPOYAS": [-6.2025, -77.8547],
            "MAZAMARI": [-11.3267, -74.5317],
            "NUEVO MUNDO": [-11.5500, -73.1333]
        };

        // Coordenadas y Zoom para encuadrar Per√∫ perfectamente (Basado en tu captura)
        const initialCenter = [-9.35, -75.80];
        const initialZoom = 5.6;

        // Definir l√≠mites de Per√∫ (Ampliados para permitir zoom out sin rebote brusco)
        const bounds = [
            [10.0, -95.0],
            [-25.0, -60.0]
        ];

        const map = L.map('map', {
            zoomControl: false,
            minZoom: 4.0, // Ahora permite alejar mucho m√°s
            maxZoom: 14, // Aumentamos un poco el zoom m√°ximo para la vista sat√©lite
            zoomSnap: 0.1,
            maxBounds: bounds,
            maxBoundsViscosity: 1.0 // Fuerza del rebote (1.0 = muro s√≥lido)
        }).setView(initialCenter, initialZoom);

        L.control.zoom({ position: 'topleft' }).addTo(map);

        // --- DEFINICI√ìN DE CAPAS ---
        const mapaEstandar = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        });

        const mapaSatelite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri'
        });

        // Capas Meteorol√≥gicas Din√°micas (RainViewer)
        const capaPrecipitacion = L.tileLayer('', {
            attribution: 'Radar de Lluvia &copy; RainViewer',
            opacity: 0.6,
            zIndex: 1000
        });

        const capaNubes = L.tileLayer('', {
            attribution: 'Nubes &copy; RainViewer',
            opacity: 0.5,
            zIndex: 900
        });

        async function updateWeatherLayers() {
            try {
                const response = await fetch('https://api.rainviewer.com/public/weather-maps.json');
                const data = await response.json();

                const hasRadar = data.radar && data.radar.past && data.radar.past.length > 0;
                const hasSat = data.satellite && data.satellite.infrared && data.satellite.infrared.length > 0;

                if (hasRadar) {
                    const lastRadar = data.radar.past[data.radar.past.length - 1].time;
                    capaPrecipitacion.setUrl(`https://tilecache.rainviewer.com/v2/radar/${lastRadar}/256/{z}/{x}/{y}/2/1_1.png`);
                    console.log("Radar actualizado:", new Date(lastRadar * 1000).toLocaleString());
                }

                if (hasSat) {
                    const lastSat = data.satellite.infrared[data.satellite.infrared.length - 1].time;
                    capaNubes.setUrl(`https://tilecache.rainviewer.com/v2/satellite/${lastSat}/256/{z}/{x}/{y}/2/0_0.png`);
                    console.log("Nubes actualizadas:", new Date(lastSat * 1000).toLocaleString());
                }

                // Control visual de los checkboxes (difuminar si no hay data)
                const overlayLabels = document.querySelectorAll('.leaflet-control-layers-overlays label');
                overlayLabels.forEach(label => {
                    const text = label.innerText;
                    if (text.includes('Radar de Lluvia')) {
                        label.classList.toggle('layer-disabled', !hasRadar);
                    }
                    if (text.includes('Capa de Nubes')) {
                        label.classList.toggle('layer-disabled', !hasSat);
                    }
                });

            } catch (e) {
                console.error("Error al actualizar clima:", e);
            }
        }

        const baseMaps = {
            "üó∫Ô∏è Mapa Est√°ndar": mapaEstandar,
            "üõ∞Ô∏è Vista Sat√©lite": mapaSatelite
        };

        const overlays = {
            "üåßÔ∏è Radar de Lluvia": capaPrecipitacion,
            "‚òÅÔ∏è Capa de Nubes": capaNubes
        };

        // Iniciar capas
        mapaEstandar.addTo(map);
        updateWeatherLayers();
        setInterval(updateWeatherLayers, 600000); // Actualizar cada 10 min

        // Control de capas completo
        L.control.layers(baseMaps, overlays, { position: 'topright' }).addTo(map);

        // Crear Bot√≥n de Reset View (üè†) debajo del Zoom
        L.Control.ResetView = L.Control.extend({
            options: { position: 'topleft' },
            onAdd: function (map) {
                const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                const button = L.DomUtil.create('a', 'leaflet-control-reset', container);
                button.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="color: var(--azul-oscuro); display: block;">
                        <path d="M3 7V5a2 2 0 0 1 2-2h2"></path>
                        <path d="M17 3h2a2 2 0 0 1 2 2v2"></path>
                        <path d="M21 17v2a2 2 0 0 1-2 2h-2"></path>
                        <path d="M7 21H5a2 2 0 0 1-2-2v-2"></path>
                    </svg>
                `;
                button.title = 'Reiniciar Vista';
                button.style.display = 'flex';
                button.style.alignItems = 'center';
                button.style.justifyContent = 'center';

                L.DomEvent.on(button, 'click', function (e) {
                    L.DomEvent.stopPropagation(e);
                    map.setView(initialCenter, initialZoom);
                });

                return container;
            }
        });
        map.addControl(new L.Control.ResetView());

        let currentFilter = 'TODOS';
        let lastData = null; // Guardar √∫ltima data para re-filtrar sin fetch

        // Manejo del Men√∫ Hamburguesa
        const btnHamburguesa = document.getElementById('btn-hamburguesa');
        const menuFiltros = document.getElementById('menu-filtros');
        const filterOptions = document.querySelectorAll('.filter-option');

        btnHamburguesa.addEventListener('click', (e) => {
            e.stopPropagation();
            menuFiltros.classList.toggle('active');
        });

        document.addEventListener('click', () => menuFiltros.classList.remove('active'));

        filterOptions.forEach(opt => {
            opt.addEventListener('click', function () {
                filterOptions.forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.getAttribute('data-filter');
                renderDashboard(lastData);
            });
        });

        async function updateDashboard() {
            try {
                const response = await fetch('vuelos_dashboard.json');
                const data = await response.json();
                lastData = data;
                renderDashboard(data);
            } catch (e) {
                console.warn("Error cargando datos. Usa python -m http.server");
            }
        }

        function renderDashboard(data) {
            if (!data) return;

            document.getElementById('sync-time').innerText = `SINCRONIZACI√ìN: ${data.ultima_sincronizacion}`;

            // FILTRAR DATA
            const vuelosFiltrados = data.vuelos.filter(v => {
                if (currentFilter === 'TODOS') return true;
                return v.tipo === currentFilter;
            });

            document.getElementById('flight-count-badge').innerText = `${vuelosFiltrados.length} CANCELACIONES`;

            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';

            map.eachLayer(layer => {
                if (layer instanceof L.Marker) map.removeLayer(layer);
            });

            if (vuelosFiltrados.length > 0) {
                const vuelosPorCiudad = {};

                vuelosFiltrados.forEach(vuelo => {
                    const isSalida = vuelo.tipo === 'SALIDAS';
                    const badgeClass = isSalida ? 'badge-salida' : 'badge-llegada';
                    const tipoIcon = isSalida ? 'üõ´' : 'üõ¨';
                    const tipoLabel = isSalida ? 'SALIDA' : 'LLEGADA';

                    // Tabla
                    const row = `<tr>
                        <td><span class="${badgeClass}">${tipoIcon} ${tipoLabel}</span></td>
                        <td class="vuelo-id">${vuelo.vuelo}</td>
                        <td style="color: #64748b; font-size: 0.8rem;">${vuelo.aerolinea}</td>
                        <td><b>${vuelo.ciudad}</b></td>
                        <td>${vuelo.hora_prog}</td>
                        <td><span class="badge-cancel">CANCELADO</span></td>
                    </tr>`;
                    tableBody.innerHTML += row;

                    // Agrupaci√≥n Mapa
                    const ciudadUpper = vuelo.ciudad.toUpperCase();
                    if (!vuelosPorCiudad[ciudadUpper]) vuelosPorCiudad[ciudadUpper] = [];
                    vuelosPorCiudad[ciudadUpper].push(vuelo);
                });

                // Render Mapa
                Object.keys(vuelosPorCiudad).forEach(ciudadKey => {
                    const vuelosLugar = vuelosPorCiudad[ciudadKey];
                    if (COORDENADAS[ciudadKey]) {
                        const [lat, lon] = COORDENADAS[ciudadKey];

                        // Pulso
                        const pulseIcon = L.divIcon({
                            className: 'custom-div-icon',
                            html: '<div class="radar-pulse"></div>',
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        });
                        L.marker([lat, lon], { icon: pulseIcon, interactive: false }).addTo(map);

                        // Punto
                        const dotIcon = L.divIcon({
                            className: 'dot-marker-pro',
                            iconSize: [12, 12],
                            iconAnchor: [6, 6]
                        });
                        const marker = L.marker([lat, lon], { icon: dotIcon }).addTo(map);

                        const tooltipText = vuelosLugar.map(v => v.vuelo).join('-');
                        marker.bindTooltip(tooltipText, {
                            permanent: true,
                            direction: 'right',
                            className: 'leaflet-tooltip-own',
                            offset: [12, 0],
                            interactive: true
                        });

                        marker.on('tooltipclick', () => marker.openPopup());

                        let popupContent = `
                            <div style="font-family: 'Inter', sans-serif; min-width: 220px; padding: 5px;">
                                <div style="text-align:center; border-bottom: 2px solid var(--punto-alerta); margin-bottom: 12px; padding-bottom: 8px;">
                                    <b style="font-size:1.1rem; color:var(--azul-oscuro); text-transform:uppercase;">${ciudadKey}</b>
                                </div>
                                <div style="display:flex; flex-direction:column; gap:10px;">
                        `;

                        vuelosLugar.forEach(v => {
                            const tIcon = v.tipo === 'SALIDAS' ? 'üõ´' : 'üõ¨';
                            popupContent += `
                                <div style="border-bottom: 1px solid #f0f0f0; padding-bottom: 8px;">
                                    <div style="display:flex; justify-content:space-between; align-items:center;">
                                        <b style="color:var(--azul-oscuro);">${v.vuelo}</b>
                                        <span style="font-size:0.75rem;">${v.hora_prog}</span>
                                    </div>
                                    <div style="font-size:0.75rem;">${tIcon} ${v.aerolinea}</div>
                                </div>
                            `;
                        });
                        popupContent += `</div></div>`;
                        marker.bindPopup(popupContent);
                    }
                });
            }
        }

        updateDashboard();
        setInterval(updateDashboard, 60000);
    </script>
</body>

</html>